defmodule PrinterTest do
  use ExUnit.Case
  doctest Printer

  describe "pretty/2" do
    test "3 sell walls detected at 1, 2, 3" do
      walls = [
        %Wall{price: 1.0, total: 0.1, precision: 0},
        %Wall{price: 2.0, total: 0.1, precision: 0},
        %Wall{price: 3.0, total: 0.1, precision: 0}
      ]

      assert Printer.pretty(walls, "sell") == "3 sell walls detected at 1.0, 2.0, 3.0"
    end

    test "with book" do
      book = example_book()
      time = "2019-04-14 17:24:32.494"
      sell_walls = Wall.detect(book.asks, type: :ask, precision: 0, threshold: 0.5)
      buy_walls = Wall.detect(book.bids, type: :bid, precision: 0, threshold: 0.5)

      assert Printer.pretty(time, book.symbol, sell_walls, buy_walls) == """
             \[2019-04-14 17:24:32.494] BTCUSDT 4 sell walls detected at 5200.0, 5055.0, 5047.0, 5046.0
             \[2019-04-14 17:24:32.494] BTCUSDT 4 buy walls detected at 5010.0, 5015.0, 5025.0, 5042.0\
             """
    end

    def example_book() do
      %Book{
        symbol: "BTCUSDT",
        asks: [
          ["5043.64000000", "0.00000000"],
          ["5043.83000000", "0.00000000"],
          ["5043.84000000", "0.00000000"],
          ["5044.50000000", "0.00000000"],
          ["5044.60000000", "0.00000000"],
          ["5044.79000000", "0.00000000"],
          ["5045.28000000", "0.00000000"],
          ["5045.29000000", "0.00000000"],
          ["5045.54000000", "0.59523400"],
          ["5046.04000000", "0.23807100"],
          ["5046.06000000", "0.00000000"],
          ["5046.07000000", "0.45577800"],
          ["5046.23000000", "0.47610200"],
          ["5046.40000000", "0.39676000"],
          ["5046.88000000", "1.82123800"],
          ["5048.06000000", "0.00000000"],
          ["5048.29000000", "0.00000000"],
          ["5048.40000000", "0.00000000"],
          ["5049.86000000", "0.00000000"],
          ["5050.04000000", "0.00000000"],
          ["5053.04000000", "0.00000000"],
          ["5053.15000000", "0.30000000"],
          ["5055.00000000", "0.48959400"],
          ["5055.23000000", "0.00000000"],
          ["5057.15000000", "0.00000000"],
          ["5058.29000000", "0.00000000"],
          ["5062.94000000", "0.10000000"],
          ["5200.00000000", "106.37296000"]
        ],
        bids: [
          ["5043.65000000", "0.00000000"],
          ["5043.64000000", "0.04360500"],
          ["5043.63000000", "0.11178100"],
          ["5042.80000000", "1.94200900"],
          ["5042.23000000", "0.03668400"],
          ["5042.22000000", "0.00000000"],
          ["5042.21000000", "0.06725800"],
          ["5042.20000000", "0.00000000"],
          ["5042.19000000", "24.64539200"],
          ["5042.18000000", "6.00000000"],
          ["5042.17000000", "2.10000000"],
          ["5042.16000000", "3.37000000"],
          ["5041.97000000", "0.00000000"],
          ["5041.39000000", "0.00000000"],
          ["5040.59000000", "0.74110600"],
          ["5040.29000000", "0.34906300"],
          ["5038.91000000", "0.00000000"],
          ["5037.51000000", "0.00000000"],
          ["5031.20000000", "0.00000000"],
          ["5030.26000000", "0.00000000"],
          ["5028.86000000", "0.00000000"],
          ["5025.00000000", "1.12407800"],
          ["5015.00000000", "4.26369000"],
          ["5010.00000000", "2.78159600"],
          ["5003.00000000", "1.04039100"]
        ]
      }
    end
  end
end
